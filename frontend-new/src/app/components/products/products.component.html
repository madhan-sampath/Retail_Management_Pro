<div class="fade-in">
  <!-- Page Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1 class="h3 mb-1 text-gradient">Products</h1>
      <p class="text-muted mb-0">Manage your product inventory and catalog.</p>
    </div>
    <div class="d-flex gap-2">
      <button class="btn btn-outline-primary" (click)="exportProducts()">
        <span class="material-symbols-outlined me-2">download</span>Export
      </button>
      <button class="btn btn-primary" (click)="openAddModal()">
        <span class="material-symbols-outlined me-2">add</span>New Product
      </button>
    </div>
  </div>

  <!-- Filters and Search -->
  <div class="card mb-4">
    <div class="card-body">
      <div class="row g-3">
        <div class="col-md-4">
          <label class="form-label">Search Products</label>
          <div class="input-group">
            <span class="input-group-text">
              <span class="material-symbols-outlined">search</span>
            </span>
            <input type="text" class="form-control" placeholder="Search by name, SKU, category..."
                   [(ngModel)]="searchQuery" (input)="searchProducts()">
          </div>
        </div>
        <div class="col-md-2">
          <label class="form-label">Category</label>
          <select class="form-select" [(ngModel)]="selectedCategory" (change)="filterProducts()">
            <option value="">All Categories</option>
            <option *ngFor="let category of categories" [value]="category.id">
              {{ category.name }}
            </option>
          </select>
        </div>
        <div class="col-md-2">
          <label class="form-label">Status</label>
          <select class="form-select" [(ngModel)]="selectedStatus" (change)="filterProducts()">
            <option value="">All Status</option>
            <option value="active">Active</option>
            <option value="inactive">Inactive</option>
            <option value="discontinued">Discontinued</option>
          </select>
        </div>
        <div class="col-md-2">
          <label class="form-label">Stock Level</label>
          <select class="form-select" [(ngModel)]="selectedStockLevel" (change)="filterProducts()">
            <option value="">All Stock</option>
            <option value="low">Low Stock</option>
            <option value="out">Out of Stock</option>
            <option value="in-stock">In Stock</option>
          </select>
        </div>
        <div class="col-md-2">
          <label class="form-label">View Mode</label>
          <div class="btn-group w-100" role="group">
            <button type="button" class="btn btn-outline-primary" 
                    [class.active]="viewMode === 'table'" (click)="setViewMode('table')">
              <span class="material-symbols-outlined">table_rows</span>
            </button>
            <button type="button" class="btn btn-outline-primary" 
                    [class.active]="viewMode === 'grid'" (click)="setViewMode('grid')">
              <span class="material-symbols-outlined">grid_view</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Products Table/Grid -->
  <div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h5 class="card-title mb-0">Products ({{ filteredProducts.length }})</h5>
      <div class="d-flex gap-2">
        <button class="btn btn-outline-primary btn-sm" (click)="refreshProducts()">
          <span class="material-symbols-outlined">refresh</span>
        </button>
      </div>
    </div>
    <div class="card-body p-0">
      <!-- Loading State -->
      <div *ngIf="loading" class="text-center py-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-2 text-muted">Loading products...</p>
      </div>

      <!-- Table View -->
      <div *ngIf="!loading && viewMode === 'table'" class="table-responsive">
        <table class="table table-hover mb-0">
          <thead class="table-light">
            <tr>
              <th>Product</th>
              <th>SKU</th>
              <th>Category</th>
              <th>Price</th>
              <th>Stock</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let product of filteredProducts">
              <td>
                <div class="d-flex align-items-center">
                  <div class="product-image me-3">
                    <div class="bg-light rounded d-flex align-items-center justify-content-center"
                         style="width: 40px; height: 40px;">
                      <span class="material-symbols-outlined text-muted">inventory</span>
                    </div>
                  </div>
                  <div>
                    <div class="fw-bold">{{ product.name }}</div>
                    <small class="text-muted">{{ this.truncateText(product.description, 50) }}...</small>
                  </div>
                </div>
              </td>
              <td>
                <code>{{ product.sku }}</code>
              </td>
              <td>
                <span class="badge bg-secondary">{{ this.formatTitleCase(product.category) }}</span>
              </td>
              <td>
                <strong>\${{ this.formatNumber(product.price) }}</strong>
              </td>
              <td>
                <span [class]="product.stockQuantity <= product.minStockLevel ? 'text-warning' : 'text-success'">
                  {{ product.stockQuantity }}
                </span>
                <small class="text-muted d-block">Min: {{ product.minStockLevel }}</small>
              </td>
              <td>
                <span class="badge" [class]="'bg-' + (product.status === 'active' ? 'success' : product.status === 'inactive' ? 'warning' : 'danger')">
                  {{ this.formatTitleCase(product.status) }}
                </span>
              </td>
              <td>
                <div class="action-buttons">
                  <button class="btn btn-action btn-edit" (click)="editProduct(product)" title="Edit Product">
                    <span class="material-symbols-outlined">edit</span>
                  </button>
                  <button class="btn btn-action btn-view" (click)="viewProduct(product)" title="View Details">
                    <span class="material-symbols-outlined">visibility</span>
                  </button>
                  <button class="btn btn-action btn-delete" (click)="deleteProduct(product)" title="Delete Product">
                    <span class="material-symbols-outlined">delete</span>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Grid View -->
      <div *ngIf="!loading && viewMode === 'grid'" class="row p-3">
        <div class="col-xl-3 col-lg-4 col-md-6 mb-4" *ngFor="let product of filteredProducts">
          <div class="card h-100 product-card">
            <!-- Action Buttons -->
            <div class="action-buttons">
              <button class="btn btn-action btn-edit" (click)="editProduct(product)" title="Edit Product">
                <span class="material-symbols-outlined">edit</span>
              </button>
              <button class="btn btn-action btn-view" (click)="viewProduct(product)" title="View Details">
                <span class="material-symbols-outlined">visibility</span>
              </button>
              <button class="btn btn-action btn-delete" (click)="deleteProduct(product)" title="Delete Product">
                <span class="material-symbols-outlined">delete</span>
              </button>
            </div>
            
            <div class="card-body">
              <div class="text-center mb-3">
                <div class="product-image mx-auto mb-3">
                  <div class="bg-gradient rounded d-flex align-items-center justify-content-center"
                       style="width: 80px; height: 80px; background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);">
                    <span class="material-symbols-outlined text-muted" style="font-size: 2rem;">inventory</span>
                  </div>
                </div>
                <h6 class="card-title">{{ product.name }}</h6>
                <p class="text-muted small">{{ this.truncateText(product.description, 60) }}...</p>
              </div>
              <div class="mb-3">
                <div class="d-flex justify-content-between">
                  <span class="text-muted">SKU:</span>
                  <code>{{ product.sku }}</code>
                </div>
                <div class="d-flex justify-content-between">
                  <span class="text-muted">Price:</span>
                  <strong>\${{ this.formatNumber(product.price) }}</strong>
                </div>
                <div class="d-flex justify-content-between">
                  <span class="text-muted">Stock:</span>
                  <span [class]="product.stockQuantity <= product.minStockLevel ? 'text-warning' : 'text-success'">
                    {{ product.stockQuantity }}
                  </span>
                </div>
                <div class="d-flex justify-content-between">
                  <span class="text-muted">Status:</span>
                  <span class="badge" [class]="'bg-' + (product.status === 'active' ? 'success' : product.status === 'inactive' ? 'warning' : 'danger')">
                    {{ this.formatTitleCase(product.status) }}
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div *ngIf="!loading && filteredProducts.length === 0" class="text-center py-5">
        <span class="material-symbols-outlined text-muted mb-3" style="font-size: 3rem;">inventory_2</span>
        <h5 class="text-muted">No products found</h5>
        <p class="text-muted">Try adjusting your search criteria or create a new product.</p>
        <button class="btn btn-primary" (click)="openAddModal()">
          <span class="material-symbols-outlined me-2">add</span>New Product
        </button>
      </div>
    </div>
  </div>

  <!-- Product Modal -->
  <div *ngIf="showModal" class="modal fade show d-block" tabindex="-1" style="background-color: rgba(0,0,0,0.5);">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">{{ modalTitle }}</h5>
          <button type="button" class="btn-close" (click)="closeModal()"></button>
        </div>
        <div class="modal-body">
          <form>
            <div class="row g-3 mb-4">
              <div class="col-md-6">
                <label class="form-label">Product Name *</label>
                <input type="text" class="form-control" [(ngModel)]="productForm.name" 
                       name="name" required [disabled]="!isEditMode && modalTitle === 'Product Details'">
              </div>
              <div class="col-md-6">
                <label class="form-label">SKU *</label>
                <input type="text" class="form-control" [(ngModel)]="productForm.sku" 
                       name="sku" required [disabled]="!isEditMode && modalTitle === 'Product Details'">
              </div>
              <div class="col-md-6">
                <label class="form-label">Category *</label>
                <select class="form-select" [(ngModel)]="productForm.categoryId" 
                        name="categoryId" required [disabled]="!isEditMode && modalTitle === 'Product Details'">
                  <option value="">Select Category</option>
                  <option *ngFor="let category of categories" [value]="category.id">
                    {{ category.name }}
                  </option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label">Status</label>
                <select class="form-select" [(ngModel)]="productForm.status" 
                        name="status" [disabled]="!isEditMode && modalTitle === 'Product Details'">
                  <option value="active">Active</option>
                  <option value="inactive">Inactive</option>
                  <option value="discontinued">Discontinued</option>
                </select>
              </div>
              <div class="col-md-4">
                <label class="form-label">Price *</label>
                <div class="input-group">
                  <span class="input-group-text">\$</span>
                  <input type="number" class="form-control" [(ngModel)]="productForm.price" 
                         name="price" step="0.01" required [disabled]="!isEditMode && modalTitle === 'Product Details'">
                </div>
              </div>
              <div class="col-md-4">
                <label class="form-label">Stock Quantity *</label>
                <input type="number" class="form-control" [(ngModel)]="productForm.stockQuantity" 
                       name="stockQuantity" required [disabled]="!isEditMode && modalTitle === 'Product Details'">
              </div>
              <div class="col-md-4">
                <label class="form-label">Min Stock Level</label>
                <input type="number" class="form-control" [(ngModel)]="productForm.minStockLevel" 
                       name="minStockLevel" [disabled]="!isEditMode && modalTitle === 'Product Details'">
              </div>
              <div class="col-12">
                <label class="form-label">Description</label>
                <textarea class="form-control" rows="3" [(ngModel)]="productForm.description" 
                          name="description" [disabled]="!isEditMode && modalTitle === 'Product Details'"></textarea>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-primary" (click)="closeModal()">Close</button>
          <button *ngIf="isEditMode" type="button" class="btn btn-primary" (click)="saveProduct()">
            <span class="material-symbols-outlined me-2">save</span>Save Changes
          </button>
          <button *ngIf="!isEditMode && modalTitle !== 'Product Details'" type="button" class="btn btn-primary" (click)="saveProduct()">
            <span class="material-symbols-outlined me-2">add</span>Create Product
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
